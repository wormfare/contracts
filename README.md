# Wormfare Smart Contracts

## Documentation

### Full docs

[TokenSale](./docs/Wormfare%20TokenSale%20Smart%20Contract.pdf) - `contracts/TokenSale.sol`

### Short docs

[TokenSale](./docs/TokenSale.md) - `contracts/TokenSale.sol`  
[WormfareGenesis](./docs/WormfareGenesis.md) - `contracts/nft/WormfareGenesis.sol`
[Spinner](./docs/Spinner.md) - `contracts/spinner/Spinner.sol`

## Getting Started

Recommended Node version is 18.0.0 and above.

### Available commands

```sh
# install the dependencies
yarn

# runs the solhint linter and print the report
yarn lint

# build for production
yarn build

# start the local Hardhat network and deploy the contract to it
yarn start

# run the tests
yarn test

# run the tests with coverage and save the report
yarn coverage

# generate contract docs and save them to ./docs/api
yarn docs

# run tests filtered by a regexp
yarn t "TokenSale"

# deploy to the dev env
yarn deploy-dev

# deploy to the stage env
yarn deploy-stage

# deploy to the stage2 env
yarn deploy-stage2

# deploy to the testnet env
yarn deploy-testnet

# deploy to the mainnet env
yarn deploy-mainnet
```

### Quick start

```shell
cp .env.example .env && cp .env.example .env.stage && cp .env.example .env.stage2 && cp .env.example .env.mainnet
```

```shell
yarn
```

Run Hardhat's testing network:

```shell
yarn start
```

> this loads the `.env` file and automatically runs your deployment scripts

Run the tests:

```shell
yarn test
```

Run the tests with coverage:

```shell
yarn coverage
```

Run the tests with Gas usage report:

```shell
REPORT_GAS=1 yarn test
```

Run a specific test(s):

```sh
yarn t "test description"
```

> "test description" is a regular expression, so do not forget to escape special symbols there (if you have any)

Generate docs (`docs/api` folder):

```
yarn docs
```

## Deploy

### Dev/Stage deployment

Deploy the Tether contract first:

```sh
yarn deploy-dev --tags Tether
yarn deploy-stage --tags Tether
GAS_PRICE=100 yarn deploy-testnet --tags Tether
```

Open `.env.dev` or `.env.stage` and fill the `USDT_CONTRACT_ADDRESS` var.

Now deploy the rest of the contracts:

```sh
yarn deploy-dev
yarn deploy-stage
```

When deploying to the `stage2` or `mainnet` environments, the `GAS_PRICE` env variable must be specified (in GWei).

### Production deployment

Deploy the TokenSale contract with a gas price set to 250 GWei:

```sh
GAS_PRICE=250 yarn deploy-mainnet --tags TokenSale
```

### Upgrading contracts

Upgrade the TokenSale contract:

```sh
UPGRADE=1 GAS_PRICE=250 yarn deploy-mainnet --tags TokenSale
```

### Verify contracts

1. Get an API key from polygonscan https://polygonscan.com/myapikey
2. Run `npx hardhat vars set ETHERSCAN_API_KEY` and paste your API key
3. Run:

```sh
NODE_ENV=mainnet yarn hardhat --network mainnet etherscan-verify
```

This command uses the `handhat-deploy` plugin to verify the contracts.

## Project Structure

This is a Hardhat TypeScript project composed of contracts, tests, and deploy instructions that provides a great starting point for developers to quickly get up and running and deploying smart contracts on the Ethereum blockchain.

### Tests

Tests are found in the `./test` folder. `./test/utils/` contains various test helpers. No additional keys are required to run the tests.

Both positive and negative cases are covered, and the test coverage is 100%.

### Contracts

Solidity smart contracts are found in the `./contracts` folder.

`./contracts/testing` folder contains contracts mocks that are used for testing purposes.

### Docs

Docs are found in the `./docs` directory. The `./docs/api` folder contains autogenerated docs for each smart contract.
